<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Ловец мандаринов</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
    background:#000;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    overflow:hidden;
    font-family:sans-serif;
}
#gameWrapper{
    position:relative;
}
canvas{
    border:2px solid #000;
    background:#111;
}
/* Кнопки движения по умолчанию скрыты */
.control{
    display:none;
}

/* Для тач-устройств показываем */
@media (pointer: coarse) {
    .control{
        display:block;
    }
}
/* Кнопки управления */
.control{
    position:absolute;
    bottom:20px;
    width: 80px;
    height:110px;
}
#leftBtn{left:20px;}
#rightBtn{right:20px;}
#pauseBtn{
    position:absolute;
    top:12px;
    right:12px;
    width:48px;
    height:48px;
    z-index: 10;
}

/* Экран паузы */
#pauseScreen,
#gameOver{
    position:absolute;
    inset:0;
    background:rgba(0,0,0,0.8);
    color:#fff;
    display:none;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    text-align:center;
}
button{
    padding:10px 20px;
    margin-top:10px;
    font-size:16px;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
</style>
</head>

<body>

<div id="gameWrapper">
    <canvas id="game" width="400" height="700"></canvas>

    <!-- Кнопки управления -->
    <img id="leftBtn" class="control" src="btn_left.png">
    <img id="rightBtn" class="control" src="btn_right.png">
    <img id="pauseBtn" src="btn_pause.png">

    <!-- Пауза -->
    <div id="pauseScreen">
        <h2>Пауза</h2>
        <button onclick="resumeGame()">Продолжить</button>
    </div>

    <!-- Game Over -->
    <div id="gameOver">
        <h2>Игра окончена</h2>
        <p>Твой счёт: <span id="finalScore">0</span></p>
        <button onclick="restartGame()">Начать заново</button>
        <button onclick="shareScore()">Поделиться рекордом</button>
    </div>
</div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

const W = canvas.width;
const H = canvas.height;

// === Картинки ===
const playerImg = new Image(); playerImg.src = 'player.png';
const bgImg = new Image(); bgImg.src = 'background.png';
const mandarinImg = new Image(); mandarinImg.src = 'mandarin.png';

// === Игровые данные ===
let player, mandarins, score, lives, paused, over;
let combo, comboMultiplier, comboTimer;
let highScore = localStorage.getItem('mandarinHighScore') || 0;

function init(){
    player = {x:W/2-25,y:H-90,w:80,h:110,speed:6};
    mandarins = [];
    score = 0;
    lives = 5;
    combo = 0;
    comboMultiplier = 1;
    comboTimer = 0;
    paused = false;
    over = false;
    document.getElementById('gameOver').style.display='none';
}
init();

// === Управление ===
let moveLeft=false, moveRight=false;

document.getElementById('leftBtn').addEventListener('touchstart',()=>moveLeft=true);
document.getElementById('leftBtn').addEventListener('touchend',()=>moveLeft=false);
document.getElementById('rightBtn').addEventListener('touchstart',()=>moveRight=true);
document.getElementById('rightBtn').addEventListener('touchend',()=>moveRight=false);

document.addEventListener('keydown',e=>{
    if(e.key==='ArrowLeft') moveLeft=true;
    if(e.key==='ArrowRight') moveRight=true;
});
document.addEventListener('keyup',e=>{
    if(e.key==='ArrowLeft') moveLeft=false;
    if(e.key==='ArrowRight') moveRight=false;
});

// === Пауза ===
document.getElementById('pauseBtn').onclick=()=>{
    paused=true;
    document.getElementById('pauseScreen').style.display='flex';
};
function resumeGame(){
    paused=false;
    document.getElementById('pauseScreen').style.display='none';
}

// === Мандарины ===
function spawnMandarin(){
    mandarins.push({
        x:Math.random()*(W-40),
        y:-40,
        w:40,h:40,
        speed:3+score*0.04
    });
}

// === Логика ===
function update(){
    if(paused||over) return;

    if(moveLeft) player.x-=player.speed;
    if(moveRight) player.x+=player.speed;
    player.x=Math.max(0,Math.min(W-player.w,player.x));

    comboTimer--;
    if(comboTimer<=0){
        combo = 0;
        comboMultiplier = 1;
    }

    mandarins.forEach((m,i)=>{
        m.y+=m.speed;

        // Промах
        if(m.y>H){
            mandarins.splice(i,1);
            lives--;
            combo = 0;
            comboMultiplier = 1;
            if(lives<=0) endGame();
        }

        // Попадание
        if(
            m.x < player.x + player.w &&
            m.x + m.w > player.x &&
            m.y < player.y + player.h &&
            m.y + m.h > player.y
        ){
            combo++;
            comboTimer = 120; // 2 секунды на продолжение
            comboMultiplier = Math.floor(combo / 5) + 1;
            score += comboMultiplier;
            mandarins.splice(i,1);
        }
    });

    if(Math.random()<0.02) spawnMandarin();
}

// === Отрисовка ===
function draw(){
    ctx.drawImage(bgImg,0,0,W,H);
    ctx.drawImage(playerImg,player.x,player.y,player.w,player.h);
    mandarins.forEach(m=>ctx.drawImage(mandarinImg,m.x,m.y,m.w,m.h));

    ctx.fillStyle='#fff';
    ctx.font='18px Arial';
    ctx.fillText(`Счёт: ${score}`,10,25);
    ctx.fillText(`Рекорд: ${highScore}`,10,50);
    ctx.fillText(`Жизни: ${lives}`,10,75);

    if(comboMultiplier > 1){
        ctx.fillStyle='#ffa500';
        ctx.font='bold 26px Arial';
        ctx.fillText(`x${comboMultiplier} COMBO`, W/2-80, 120);
    }
}

// === Конец ===
function endGame(){
    over=true;
    if(score>highScore){
        highScore=score;
        localStorage.setItem('mandarinHighScore',highScore);
    }
    document.getElementById('finalScore').innerText=score;
    document.getElementById('gameOver').style.display='flex';
}

function restartGame(){
    init();
}

// === Поделиться ===
function shareScore(){
    window.open('https://t.me/arbekovopnz58/12019','_blank');
}

// === Цикл ===
function loop(){
    update();
    draw();
    requestAnimationFrame(loop);
}
loop();
</script> 

</body>
</html>